<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <title>Twiddler</title>
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>
  <body>

    <script>

      $(document).ready(function(){
        var $body = $('body');
        $body.html('');

        var $name = $('<h1 class="name">Kiwi</h1>');
        $name.appendTo($body);

        var $username = $('<h2 class="username">@KiwiTheWeenie</h1>');
        $username.appendTo($body);

        var $refreshButton = $('<button id="new-tweets">New Tweets</button>');
        $refreshButton.appendTo($body);

        var $backButton = $('<button id="back-button">Back To Feed</button>');
        $backButton.appendTo($body).hide();

        //fetch first tweets
        console.log(`streams.home.length: ${streams.home.length}`)
        var endingIndex = streams.home.length;
        var index = streams.home.length - 1;
        while(index >= 0){
          var tweet = streams.home[index];
          var $tweet = $(`<div class="tweet" id="${tweet.user}"></div>`);
          $tweet.text(`@${tweet.user}: ${tweet.message} ${tweet.created_at}`);
          $tweet.appendTo($body);
          index -= 1;
        };

        //functionality for refresh button
        $refreshButton.on("click", function(){
          console.log("new tweets clicked");
          //$(".tweet").remove();
          console.log(`streams.home.length: ${streams.home.length}`)
          console.log(`endingIndex: ${endingIndex}`)
          var index = streams.home.length - 1;
          while(index >= streams.home.length - endingIndex){
            var tweet = streams.home[index];
            var $tweet = $(`<div class="tweet" id="${tweet.user}"></div>`);
            $tweet.text(`@${tweet.user}: ${tweet.message} ${tweet.created_at}`);
            $tweet.appendTo($body);
            index -= 1;
          }
          var endingIndex = streams.home.length;
          console.log(`endingIndex: ${endingIndex}`)
        });

        //functionality for clicking on a user's tweet
        $('.tweet').each(function(){
          $(this).on("click", function(e){
            console.log("tweet clicked")
            $refreshButton.hide();
            $('.tweet').not(`#${e.target.id}`).hide();
            $backButton.show();
          });
        });

        //functionality for back button
        $backButton.on("click", function(){
          console.log("back button clicked");
          $('.tweet').show();
          $refreshButton.show();
          $backButton.hide();
        })
      });

    </script>
  </body>
</html>
